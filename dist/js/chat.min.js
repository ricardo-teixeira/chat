(function(){angular.module("ValueChat",["ngResource","ngSanitize","angularMoment","ngAnimate","emojiApp"]),angular.module("ValueChat").directive("chatSidebar",["$rootScope",function(t){var a="<div class='error-log' ng-if='vm.errorLog(1)'><i class='fa fa-chain-broken' aria-hidden='true'></i>{{vm.errorLog(1).message}}</div><div class='chat-sidebar-container' ng-if='!vm.errorLog(1)'><div class='chat-sidebar-header'><ul class='chat-navbar left'>{{currentStatus | json}}<li ng-class=\"{active: isActiveTab('status')}\"><a class='chat-navbar-brand' ng-click=\"setActiveTab('status')\"><span chat-status='vm.currentStatus.id'></span> {{vm.currentStatus.name}} <i class='fa fa-angle-down'></i></a></li></ul><ul class='chat-navbar right'><li ng-if='!vm.errorLog(2)' ng-class=\"{active: isActiveTab('search')}\"><a href='javascript:;' ng-click=\"setActiveTab('search')\"><i class='fa fa-search'></i></a></li><li ng-class=\"{active: isActiveTab('config')}\"><a href='javascript:;' ng-click=\"setActiveTab('config')\"><i class='fa fa-cog'></i></a></li><li><a class='chat-toggle' href='javascript:;' ng-click='toggleChat()'><i class='fa fa-chevron-right'></i></a></li></ul></div><div class='chat-body slim-scrollbar-dark'><div class='tab-content' ng-show=\"isActiveTab('status')\"><ul><li ng-repeat='status in vm.statusList'><a href='javascript:;' ng-click='vm.changeStatus(status.id)'><span chat-status='status.id'></span>{{status.name}}</a></li></ul></div><div class='tab-content' ng-show=\"isActiveTab('search')\"><input class='search-input' placeholder='Digite o nome do contato' type='text' ng-model='searchBy.text' focus-on=\"isActiveTab('search')\" ng-keyup='vm.searchContact(searchBy.text, contactlist.length)' min-length='3'></div><div class='tab-content full' ng-show=\"isActiveTab('config')\"><ul><li><a href='javascript:;'><i class='fa fa-music'></i>Som do bate-papo <switch class='pull-right' ng-model='vm.settings.sound'></switch></a></li><li><a href='javascript:;'><i class='fa fa-flag-o'></i>Notificações no navegador <switch class='pull-right' ng-model='vm.settings.notifications'></switch></a></li></ul></div><ul class='chat-contact-list search-results'><li ng-repeat='search in vm.searchResult | orderBy:\"-unreadMessages\":\"-messageDate\"' ng-class=\"{'has-unread': search.unreadMessages > 0, 'has-popup': contact.popupActive}\" ng-click='openPopup(search)'><div class='left'><img class='contact-photo' dummy-image='search.participant[0].photo' dummy-text='search.participant[0].name'><span chat-status='search.participant[0].status'></span></div><div class='right'><h4 class='contact-name' ng-bind-html='search.participant[0].name | trim:true:35 | highlight:searchBy.text'></h4><div class='contact-last-message' ng-bind-html='search.lastMessage | trim:true:35 | colonToSmiley'></div></div></li></ul><div class='error-log' ng-if='vm.errorLog(2)'><i class='fa fa-chain-broken' aria-hidden='true'></i>{{vm.errorLog(2).message}}</div><ul ng-if='!vm.errorLog(2)' class='chat-contact-list' infinite-scroll='vm.getContacts()'><li ng-repeat='contact in contactlist = (vm.contacts | filter: searchBy.text | orderBy: \"-messageDate\")' chat-popover popover-items='contact.participant[0]' popover-placement='left' popover-content='vm.popoverContactTpl' class='animate-list' ng-class=\"{'has-unread': contact.unreadMessages > 0, 'has-popup': contact.popupActive}\" ng-click='openPopup(contact)'><div class='left'><span class='contact-photo'><img dummy-image='contact.participant[0].photo' dummy-text='contact.participant[0].name'></span><span chat-status='contact.participant[0].status'></span></div><div class='right'><h4 class='contact-name' ng-bind-html='contact.participant[0].name | trim:true:35 | highlight:searchBy.text'></h4><div class='contact-last-message' ng-bind-html='contact.lastMessage | trim:true:35 | colonToSmiley'></div></div></li><div ng-show='!contactlist.length && vm.doneContacts || !contactlist.length && vm.searchResults.length' class='error-log'><i class='fa fa-users'></i>Nenhum contato encontrado</div><div chat-loader ng-show='vm.gettingContacts || !vm.doneContacts'></div></ul></div><div class='chat-sidebar-footer'><ul class='chat-navbar'><li class='active'><a href='javascript:;' ng-click=\"setActiveTab('contacts')\"><i class='fa fa-comments'></i></a></li></ul></div></div><div class='chat-popup-container'><div ng-repeat='popup in vm.popups track by popup.roomId' chat-popup='popup' popup-index='$index'></div><div ng-show='vm.popupsGrouped.length' class='popup-group' popup-group='vm.popupsGrouped' popup-group-unreads='vm.groupedUnreads'></div></div>";return{restrict:"EA",template:a,replace:!1,scope:{profile:"=chatProfile"},controller:["$scope","$timeout","ChatAPI",function(a,e,s){function o(t,a){if(!Notification)return void console.log("Desktop notifications not available in your browser.");if("granted"!==Notification.permission)Notification.requestPermission();else{new Notification(t.name,{icon:t.photo,body:a})}}var i=this;i.isConnected=s.isConnected,i.errors=[],i.settings={sound:!1,notifications:!1},i.popoverContactTpl="<div class='chat-contact-info'><div class='popover-media'><span class='contact-photo'><img dummy-image='items.photo' dummy-text='items.name' width='85' height='85'/></span></div><div class='contact-info'><h4 class='contact-name'>{{items.name}}</h4><span class='contact-company'>{{items.company}}</span><span class='contact-email' ng-if='items.email'>{{items.email}}</span></div></div>";var n=new Audio("http://www.mscs.mu.edu/~mikes/174/demos/Win98sounds/Utopia%20Critical%20Stop.wav");i.errorLog=function(t){var a=i.errors.filter(function(a){return a.code==t});return a[0]},a.$watch("vm.isConnected",function(t){t||i.errors.push({code:"1",message:"Erro ao conectar ao chat. Por favor, tente mais tarde."})}),document.addEventListener("DOMContentLoaded",function(){"granted"!==Notification.permission&&Notification.requestPermission()}),a.$watchCollection("profile.id",function(c){if(void 0!=c){i.profile=a.profile,i.contacts=[],i.popups=[],i.popupsGrouped=[],i.groupedUnreads=0;var r={id:i.profile.id,limit:20,offset:0};s.isConnected&&s.notify().get({id:r.id}).$promise.then(function(a){return t.chatNotifications=a.count},function(a){t.chatNotifications=0,i.errors.push({code:"1",message:"Erro ao conectar ao chat"})}),i.removePopup=function(t){i.popups=i.popups.filter(function(a){return a.roomId!=t}),a.$broadcast("popupremoved")};var p=!1;i.getContacts=function(){if(i.contactsCount>i.contacts.length&&!p){var t={id:i.profile.id,limit:i.contacts.length+10,offset:i.contacts.length};p=i.gettingContacts=!0,s.contact().get(t).$promise.then(function(t){t.data.forEach(function(t){i.contacts.push(t)}),p=i.gettingContacts=!1},function(t){i.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText}),console.log("Error: ",t.statusText)})}},i.statusList=[{id:1,name:"Online",active:!0},{id:2,name:"Ocupado",active:!1},{id:3,name:"Offline",active:!1},{id:4,name:"Ausente",active:!1}],i.getStatus=function(t){var a=i.statusList.filter(function(a){return a.id==t});return a[0]},i.currentStatus={},i.currentStatus=i.getStatus(i.profile.status_id),i.changeStatus=function(a){i.currentStatus=i.getStatus(a),i.profile.status_id=a,i.proxy.server.changeStatus(a),t.$broadcast("changestatus")};try{i.proxy=s.methods(),void 0!=i.proxy&&(s.start({transport:["webSockets","longPolling"]}).done(function(){return i.proxy.server.connect(i.profile.name,i.profile.id,i.profile.status_id,i.profile.systemType)}),i.doneContacts=!1,s.contact().get(r).$promise.then(function(t){i.contactsCount=t.count,i.contacts=t.data,i.doneContacts=!0},function(t){401==t.status&&(t.statusText="Não autorizado"),i.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText+". Recarregue a página ou efetue login novamente."}),i.doneContacts=!1,console.log("Error: ",t.statusText)}),i.searchContact=function(t,a){var e;return i.searchResult=[],0===a?(e={id:i.profile.id,name:t,limit:5,offset:0},s.getuserbyname().get(e).$promise.then(function(t){return i.searchResult=t.data},function(t){return console.log(t.statusText)})):void 0},i.getGroupUnreads=function(){e(function(){return i.popupsGrouped.length?(i.groupedUnreads=0,i.popupsGrouped.forEach(function(t){i.groupedUnreads+=t.unreadMessages}),i.groupedUnreads):void 0},500)},i.proxy.on("receiveMessage",function(s,c,r,p){i.getGroupUnreads(),i.settings.sound&&c!=i.profile.id&&n.play();var u=i.contacts.filter(function(t){return t.roomId==s});void 0!=u[0]&&c!==i.profile.id&&e(function(){a.$apply(function(){u[0].lastMessage=r.message,u[0].unreadMessages++,t.chatNotifications++}),i.settings.notifications&&o(u[0].participant[0],r.message)},0),i.popups.forEach(function(t){return t.roomId===s?(t.messages.splice(0,0,r),!0):void 0})}),i.proxy.on("receiveTyping",function(t,s,o){var n,c=i.contacts.filter(function(t){return t.participant[0].id==o});void 0!=c[0]&&c[0].roomId===s&&o!==a.profile.id&&a.$apply(function(){n=c[0].lastMessage,c[0].lastMessage=t+"...",e(function(){c[0].lastMessage=n},500)}),i.popups.forEach(function(i){return i.roomId===s&&o!==a.profile.id?(i.typing=t,e(function(){i.typing=!1},2e3),!0):void 0})}),i.proxy.on("updateReadMessage",function(t,e,s){i.popups.forEach(function(t){t.messages.forEach(function(t){t.senderId!=a.profile.id&&(void 0!=t.notification[0].readDate&&null!=t.notification[0].readDate||(t.notification[0].readDate=s))})})}),i.proxy.on("userStatus",function(t){return a.$apply(function(){angular.forEach(i.contacts,function(a){return a.participant[0].id===t.id?a.participant[0].status=t.chatStatus:void 0})})}),i.proxy.on("updateContactList",function(t){return t.participant.splice(0,1),a.$apply(function(){i.contacts.splice(0,0,t)})}))}catch(u){i.errors.push({code:"1",message:"Erro ao conectar ao chat"})}}},!0)}],controllerAs:"vm",link:function(t,a,e,s){t.openPopup=function(t){if(s.popupsGrouped.length){var e=s.popupsGrouped.indexOf(t);if(e>-1){var o=s.popups[0];s.popupsGrouped.splice(e,1),s.popups.splice(0,1),s.popupsGrouped.push(o),s.popups.push(t)}}if(s.popups.length>0)var i=($(window).width()-$(a).width())/($(".chat-popup").first().width()*(s.popups.length+1));if(!t.popupActive){if(void 0!=i&&1>i){var o=s.popups[0];s.popups.splice(0,1),s.popupsGrouped.push(o),s.popups.push(t)}else s.popups.push(t);t.popupActive=!0}t.highlight=!0,$("body").addClass("has-chat-popup-active")},t.tabActive=null,t.setActiveTab=function(a){t.tabActive==a?t.tabActive="":t.tabActive=a},t.isActiveTab=function(a){return null!=t.tabActive?a==t.tabActive:void 0},t.toggleChat=function(){a.toggleClass("open closed"),a.hasClass("open")?(a.addClass("open").removeClass("closed"),$("body").addClass("has-chat-sidebar-active")):(a.addClass("closed").removeClass("open"),$("body").removeClass("has-chat-sidebar-active"))},a.hasClass("open")&&$("body").addClass("has-chat-sidebar-active"),e.$observe("chatAttachTo",function(t){if(t){var e=$(t).first();void 0!=e&&$(document).ready(function(){var t=e.height();$(a).css("top",t),$(window).scroll(function(){$(window).scrollTop()>t?$(a).css("top","0px"):$(window).scrollTop()<t&&$(a).css("top",t)})})}}),e.$observe("chatToggle",function(a){a&&$(a).on("click",function(){t.toggleChat()})}),a.on("mouseenter",".chat-body",function(){a.removeClass("narrow-sidebar"),$("body").removeClass("narrow-sidebar")})}}}])}).call(this);
(function(){angular.module("ValueChat").directive("chatPopup",["ChatAPI","$rootScope","$timeout","$filter","$window",function(e,t,o,s,a){var n="<div class='popup-box chat-popup slim-scrollbar' ng-class=\"{'popup-on': popup.unreadMessages > 0, 'popup-closed': !popup.toggle}\"><div class='popup-head'><ul class='popup-head-left chat-navbar left'><li><a class='chat-navbar-brand' href='javascript:;' title='{{popup.participant[0].name}}'><span chat-status='popup.participant[0].status'></span> {{popup.participant[0].name | trim:true:14}}</a></li></ul><div class='popup-head-right'><ul class='chat-navbar popup-head-buttons right'><li class='chat-popup-toggle' ng-click='togglePopup()'><a href='javascript:;'><i class='fa fa-angle-down'></i></a></li><li class='chat-popup-close'><a href='javascript:;' ng-click='removePopup(popup.roomId)'><i class='fa fa-times'></i></a></li></ul></div></div><div class='tab-content' ng-show=\"isActiveTab('popup-config')\"><ul><li><a href='javascript:;'><i class='fa fa-ban'></i> Bloquear usuário <switch class='pull-right' ng-model='config.block'></switch></a></li></ul></div><div class='popup-messages'><div chat-loader ng-if='!popup.messages.length && !doneMessages || gettingMoreMessages'></div><div class='direct-chat-messages' auto-scroll='popup.messages' auto-scroll-trigger='popup.typing' infinite-scroll='loadMoreMessages()' scroll-inverse='true'><div ng-repeat=\"message in popup.messages | orderBy:'messageDate' track by message.messageDate\" class='direct-chat-msg animate-chat animated' ng-class=\"isMyMessage(message.senderId) ? 'me' : 'user'\"><img alt='message user image' class='direct-chat-img' dummy-image='isMyMessage(message.senderId) ? profile.photo : popup.participant[0].photo' dummy-text='isMyMessage(message.senderId) ? profile.name : popup.participant[0].name'><div class='direct-chat-text' ng-bind-html='message.message | colonToSmiley'></div><div ng-if='isMyMessage(message.senderId)' class='direct-chat-info clearfix'><span class='direct-chat-timestamp'><i class='fa fa-check' ng-show='message.notification[0].readDate'></i><span ng-bind='message.messageDate | amCalendar'></span></span></div></div><div class='direct-chat-msg direct-typing-message user' ng-show='popup.typing')><img alt='message user image' class='direct-chat-img' dummy-image='popup.participant[0].photo' dummy-text='popup.participant[0].name'><div class='direct-chat-text'><div class='loading-dots'><span></span><span></span><span></span></div></div></div></div><div ng-show='errorLog(3)' class='error-log'>{{errorLog(3).message}}</div></div><div class='popup-messages-footer'>"+'<div emoji-form emoji-message="emojiMessage" ng-click="setReadMessages()" ng-keypress="isTyping($event)" ng-disabled="errorLog(3)"><button id="emojibtn"><i class="fa fa-smile-o" aria-hidden="true"></i></button><textarea id="messageInput" ng-model="emojiMessage.messagetext" placeholder="Enviar uma mensagem"></textarea></div></div></div>';return{restrict:"EA",require:"^chatSidebar",template:n,scope:{popup:"=chatPopup",index:"=popupIndex"},replace:!0,tranclude:!0,controller:["$scope","$filter","$sanitize","ChatAPI",function(e,t,o,s){var a={roomId:e.popup.roomId,limit:10,offset:0};e.doneMessages=!1,s.message().get(a).$promise.then(function(t){e.popup.messages=t.data,e.doneMessages=!0},function(t){e.doneMessages=!0,console.log("Error: ",t.statusText)})}],link:function(a,n,i,p){function r(){var e=a.index,t=$(n).width(),o=15*e,s=15,i=t*e+(o+s);0==e&&(i=s),$(n).css({left:i})}a.profile=p.profile,a.errors=[],a.errorLog=function(e){var t=a.errors.filter(function(t){return t.code==e});return t[0]},a.emojiMessage={},a.emojiMessage.replyToUser=function(){a.sendMessage()};var c=!0;a.gettingMoreMessages=!1,a.loadMoreMessages=function(){if(c&&!a.gettingMoreMessages){var t={roomId:a.popup.roomId,limit:a.popup.messages.length+20,offset:a.popup.messages.length};a.doneMessages=!1,a.gettingMoreMessages=!0,e.message().get(t).$promise.then(function(e){return a.gettingMoreMessages=!1,0==e.data.length?(c=!1,!1):(angular.forEach(e.data,function(e){a.popup.messages.push(e)}),void(a.doneMessages=!0))},function(e){a.doneMessages=!0,console.log("Error: ",e.statusText)})}},a.removePopup=function(e){a.popup.popupActive=!1,p.removePopup(e),a.$destroy(),p.popups.length<1&&$("body").removeClass("has-chat-popup-active")},a.sendMessage=function(){try{var e=s("stripHTML")(a.emojiMessage.messagetext),t=a.popup.roomId;e.length&&p.proxy.server.sendMessage(t,e).done(function(){a.$apply(function(){a.emojiMessage.messagetext=""})}).fail(function(e){return console.log("Error: ",e)})}catch(o){a.errors.push({code:"3",message:"Erro ao enviar mensagem. Atualize a página e tente novamente."}),console.log(o)}},a.setReadMessages=function(){if(a.popup.unreadMessages>0){var s;s={roomId:a.popup.roomId,userId:a.profile.id},e.updateallmessages().put(s).$promise.then(function(){p.proxy.server.userReadMessage(s.roomId,s.userId,a.profile.systemType).done(function(){o(function(){a.popup.unreadMessages=0;var e=0;p.contacts.forEach(function(t){return void 0!=t.unreadMessages?e+=t.unreadMessages:void 0}),t.chatNotifications=e},500)}).fail(function(e){console.log("Error: ",e.statusText)})},function(e){})}};var u;u=void 0,a.isTyping=function(e){var o;13!==e.keyCode&&(o=a.popup.roomId,void 0!==u&&clearTimeout(u),u=setTimeout(function(){p.proxy.server.userIsTyping(o,t.user.status_id)},200))},a.$on("$destroy",function(){$(window).width()<768?(n.removeClass("chatSlideInLeft").addClass("chatSlideOutLeft"),o(function(){n.remove()},1e3)):n.remove()}),a.popup.toggle=!0,a.isMyMessage=function(e){return e!=a.popup.participant[0].id},a.$watch("popup.highlight",function(e){e&&(n.addClass("highlight"),setTimeout(function(){n.removeClass("highlight"),a.popup.highlight=!1,a.$apply()},1e3))}),a.togglePopup=function(){a.popup.toggle=!a.popup.toggle},a.$watch("index",function(){r()}),$(window).width()<768?$(n).addClass("chatSlideInLeft"):$(n).addClass("chatSlideInUp"),n.on("click",function(){$(".chat-sidebar, body").addClass("narrow-sidebar")})}}}]).directive("switch",function(){return{restrict:"AE",replace:!0,transclude:!0,require:"?ngModel",template:function(e,t){var o="";return o+="<span",o+=' class="switch'+(t["class"]?" "+t["class"]:"")+'"',o+=t.ngModel?' ng-click="'+t.disabled+" ? "+t.ngModel+" : "+t.ngModel+"=!"+t.ngModel+(t.ngChange?"; "+t.ngChange+'()"':'"'):"",o+=' ng-class="{ checked:'+t.ngModel+", disabled:"+t.disabled+' }"',o+=">",o+="<small></small>",o+='<input type="checkbox"',o+=t.id?' id="'+t.id+'"':"",o+=t.name?' name="'+t.name+'"':"",o+=t.ngModel?' ng-model="'+t.ngModel+'"':"",o+=' style="display:none" />',o+='<span class="switch-text">',o+=t.on?'<span class="on">'+t.on+"</span>":"",o+=t.off?'<span class="off">'+t.off+"</span>":" ",o+="</span>"}}}).directive("dummyImage",function(){return{restrict:"A",scope:{width:"@?",height:"@?",dummyImage:"=?",dummyText:"=",bgcolor:"@?",color:"@?",randomColor:"@?"},link:function(e,t){var o,s,a,n,i,p,r,c;n=function(){var e,t,o;for(o="0123456789ABCDEF".split(""),e="",t=0;6>t;)e+=o[Math.floor(16*Math.random())],t++;return e},o=e.bgcolor||"EEEEEE",s=e.color||"AAAAAA","true"===e.randomColor&&(o=n(),s="FFFFFF"),c=e.width||40,i=e.height||40,r=e.length||2,""!==e.dummyImage&&void 0!==e.dummyImage||(p="img/datagrid_load.gif",t.attr("src",p)),a=function(){if(""!==e.dummyImage&&void 0!==e.dummyImage)return t.attr("src",e.dummyImage);if(null!=e.dummyText){for(var a=e.dummyText.substr(0,r),n="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",u="aaaaaeeeeeiiiiooooouuuunc------",l=0,d=n.length;d>l;l++)a=a.replace(new RegExp(n.charAt(l),"g"),u.charAt(l));return p="http://api-valuegaia.gaiacore.com.br/dummy/"+c+"x"+i+"/"+o+"/"+s+"/"+a,t.attr("src",p)}},e.$watchCollection("[dummyImage, dummyText]",function(){return a()})}}}).directive("chatStatus",function(){return{restrict:"EA",scope:{status:"=chatStatus"},link:function(e,t){function o(e){switch(e){case 1:return"online";case 2:return"busy";case 3:return"offline";case 4:return"away"}}e.$watch("status",function(e,s){var a=o(s),n=o(e);$(t).removeClass(a).addClass(n),t.hasClass("chat-status-indicator")||t.addClass("chat-status-indicator")})}}}).directive("autoScroll",function(){return{restrict:"EA",scope:{list:"=autoScroll",typing:"=autoScrollTrigger"},link:function(e,t,o){function s(){var e;e=t.prop("scrollHeight"),$(t).animate({scrollTop:e},100)}o.stopScroll=o.stopScroll||!1,e.$watch("typing",function(e){void 0!=e&&null!=e&&s()}),e.$watchCollection("list",function(){o.stopScroll||s(),o.stopScroll=!1})}}}).directive("chatLoader",function(){return{restrict:"EA",replace:!0,template:'<div class="chat-loader"><svg class="chat-loader-container first" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg><svg class="chat-loader-container second" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg></div>'}}).filter("trim",function(){return function(e,t,o,s){if(!e)return"";if(o=parseInt(o,10),!o)return e;if(e.length<=o)return e;if(e=e.substr(0,o),t){var a=e.lastIndexOf(" ");-1!=a&&(e=e.substr(0,a))}return e+(s||"…")}}).directive("chatForm",function(){return{restrict:"A",scope:{action:"&chatFormSubmit"},link:function(e,t){$(t).bind("keydown keypress",function(t){return 13===t.which&&$(this).val().trim().length>0&&!t.shiftKey?(e.$apply(e.action),!1):void 0})}}}).directive("focusOn",["$timeout",function(e){return function(t,o,s){t.$watch(s.focusOn,function(t){t&&e(function(){o[0].focus()})})}}]).directive("infiniteScroll",["$timeout",function(e){return function(t,o,s){var a=o[0];o.bind("scroll",function(){"true"==s.scrollInverse?0==a.scrollTop&&(t.$apply(s.infiniteScroll),e(function(){a.scrollTop=10},100)):a.scrollTop+a.offsetHeight>=a.scrollHeight&&t.$apply(s.infiniteScroll)})}}]).directive("chatPopover",["$compile",function(e){return{restrict:"EA",transclude:!0,template:"<span ng-transclude></span>",scope:{items:"=?popoverItems",title:"@?",content:"=?popoverContent"},link:function(t,o,s){function a(){var a=s.popoverTrigger||"hover",n=s.popoverPlacement||"bottom",i=$('<div class="chat-popover popover"><div class="arrow"></div><div class="popover-content"></div></div>');void 0!=s.title&&""!=s.title&&$(i).find(".popover-content").before('<h3 class="popover-title"></h3>');var p={template:i,content:e(t.content)(t),placement:n,trigger:a,html:!0,title:t.title};t.items&&t.content&&(p.content=e(t.content)(t)),$(o).popover(p)}s.popoverItems?t.$watch("items",function(e){void 0!=e&&a()}):a()}}}]).directive("popupGroup",["$timeout",function(e){var t='<div class="popup-head" ng-class="{\'popup-on\': unreads > 0}"><i class="fa fa-comments"></i><span class="popup-group-count">{{contacts.length}}</span></div><div class="chat-popover popover fade top in" style="width: 300px; left: -100px;">    <div class="arrow"></div>    <div class="popover-content">    <ul class="chat-contact-list ng-scope">    <li ng-repeat="contact in contacts track by $index" class="animate-list ng-scope" ng-class="{\'has-unread\': contact.unreadMessages > 0}" ng-click="openGroupedPopup(contact)">    <div class="left"><span class="contact-photo"><img dummy-image="contact.participant[0].photo" dummy-text="contact.participant[0].name"></span>    <span chat-status="contact.participant[0].status" class="ng-isolate-scope offline chat-status-indicator"></span>    </div>    <div class="right">    <h4 class="contact-name ng-binding" ng-bind-html="contact.participant[0].name | trim:true:28">Rose Mary da Rocha Oliveira</h4>    <div class="contact-last-message ng-binding" ng-bind-html="contact.lastMessage | trim:true:35 | colonToSmiley">dfgfd</div>    </div><i class="fa fa-times chat-popup-close" ng-click="removeFromGroup(contact)"></i></li></ul></div></div>';return{require:"^chatSidebar",restrict:"EA",template:t,replace:!1,transclude:!0,scope:{contacts:"=popupGroup",unreads:"=?popupGroupUnreads"},link:function(t,o,s,a){t.$watch("popupGroupUnreads",function(e){e&&(console.log("n",e),t.unreads=e)}),o.on({click:function(){o.find(".chat-popover").toggle()}}),o.find(".chat-popover").on({click:function(){return!1}}),t.$watch("contacts",function(e,s){function n(e,t){var o=e.getBoundingClientRect(),s=t.getBoundingClientRect();return o.left<=s.left&&o.right>=s.right}void 0!=e&&($(window).on("resize",function(){if($(window).width()<768&&o.find(".chat-popover").hide(),a.popups.length){var e=n($("body")[0],$(".chat-popup").get($(".chat-popup").length-1));if(!e){var s=a.popups[0];a.popups.splice(0,1),a.popupsGrouped.push(s),t.$apply()}}if(a.popupsGrouped.length){var i;if(i=a.popups.length?($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(a.popups.length+1)):($(window).width()-$(".chat-sidebar").width())/275,i=parseInt(i),void 0!=i&&i>0){var s=a.popupsGrouped[0];a.popups.push(s),a.popupsGrouped.splice(0,1),t.$apply()}}}),t.$on("popupremoved",function(){var e=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(a.popups.length+1));if(void 0!=e&&e>1&&a.popupsGrouped.length){var t=a.popupsGrouped[0];a.popupsGrouped.splice(0,1),a.popups.push(t),a.getGroupUnreads()}}),t.openGroupedPopup=function(e){var o=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(a.popups.length+1));if(void 0!=o&&1>o){var s=a.popups[0];a.popups.splice(0,1),a.popupsGrouped.push(s),a.getGroupUnreads()}e.popupActive=!0,t.contacts=t.contacts.filter(function(t){return t.roomId!=e.roomId}),a.popups.push(e)},t.removeFromGroup=function(e){e.popupActive=!1,t.contacts=t.contacts.filter(function(t){return t.roomId!=e.roomId}),a.getGroupUnreads()})}),t.$watch("contacts.length",function(s,n){if(s!=n){var i=-(65*t.contacts.length);o.find(".chat-popover").css("top",i-10),o.find(".popover-content").css("height",-1*i),a.popupsGrouped.length&&(e(function(){var e=$(".chat-popup").eq(a.popups.length-1).offset().left+275+20;o.animate({left:e},200)},100),a.getGroupUnreads())}})}}}]).filter("highlight",["$sce",function(e){return function(t,o){return o&&(t=t.replace(new RegExp("("+o+")","gi"),'<span class="highlighted">$1</span>')),e.trustAsHtml(t)}}]).filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("stripHTML",function(){return function(e){var t=/(<([^>]+)>)/gi;return e.replace(t,"")}})}).call(this);
(function(){angular.module("ValueChat").factory("ChatAPI",["$resource",function(t){function e(t){for(var e=t+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""}var n,o;return n=decodeURIComponent(e("gaiainc_signalr_url")),o=e("gaiainc_webapi_token"),null!=$.connection&&0!==$.connection&&void 0!==n&&void 0!==o?{methods:function(){return $.connection.hub.url=""+n+"/chat",$.connection.valuechat},message:function(){return t(""+n+"/chatapi/message/:roomId",{},{get:{method:"GET",params:{roomId:"@roomId",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+o}}})},contact:function(){return t(""+n+"/chatapi/contact/:id",{},{get:{method:"GET",params:{id:"@id",limit:"@limit",offset:"@offset"},isArray:!1,headers:{Authorization:"Bearer "+o}}})},getuserbyname:function(){return t(""+n+"/chatapi/contact/getuserbyname/:id",{},{get:{method:"GET",params:{id:"@id",name:"@name",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+o}}})},updateallmessages:function(){return t(""+n+"/chatapi/message/updateallmessages/:roomId",{},{put:{method:"PUT",params:{roomId:"@roomId",userId:"@userId"},isArray:!0,headers:{Authorization:"Bearer "+o}}})},notify:function(){return t(""+n+"/chatapi/notify/:id",{},{get:{method:"GET",params:{id:"@id"},isArray:!1,headers:{Authorization:"Bearer "+o}}})},start:function(t){return this.methods().client.onConnected=function(){return console.log("onConnected")},this.methods().client.notifyUser=function(){},$.connection.hub.start(t)},isConnected:!0,reconnect:function(){return console.log("reconnecting"),t(""+n,{method:"ReAuthenticateWebApi"})}}:(console.log("Erro ao connectar com o chat. Hubs ou SignalR indisponíveis."),{isConnected:!1})}])}).call(this);