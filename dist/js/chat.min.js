(function(){angular.module("ValueChat",["ngResource","ngSanitize","angularMoment","ngAnimate","emojiApp"]),angular.module("ValueChat").directive("chatSidebar",["$rootScope",function(t){var a='<div class="error-log" ng-if="vm.errorLog(1)"><i class="fa fa-chain-broken" aria-hidden="true"></i>{{vm.errorLog(1).message}}</div><div class="chat-sidebar-container" ng-if="!vm.errorLog(1)"><div class="chat-sidebar-header"><ul class="chat-navbar left">{{currentStatus | json}}<li ng-class="{active: isActiveTab(\'status\')}"><a class="chat-navbar-brand" ng-click="setActiveTab(\'status\')"><span chat-status="vm.currentStatus.id"></span> {{vm.currentStatus.name}} <i class="fa fa-angle-down"></i></a></li></ul><ul class="chat-navbar right"><li ng-if="!vm.errorLog(2)" ng-class="{active: isActiveTab(\'search\')}"><a href="javascript:;" ng-click="setActiveTab(\'search\')"><i class="fa fa-search"></i></a></li><li ng-class="{active: isActiveTab(\'config\')}"><a href="javascript:;" ng-click="setActiveTab(\'config\')"><i class="fa fa-cog"></i></a></li><li><a class="chat-toggle" href="javascript:;" ng-click="toggleChat()"><i class="fa fa-chevron-right"></i></a></li></ul></div><div class="chat-body slim-scrollbar-dark"><div class="tab-content" ng-show="isActiveTab(\'status\')"><ul><li ng-repeat="status in vm.statusList"><a href="javascript:;" ng-click="vm.changeStatus(status.id); setActiveTab(\'contacts\')"><span chat-status="status.id"></span>{{status.name}}</a></li></ul></div><div class="tab-content" ng-show="isActiveTab(\'search\')"><input class="search-input" placeholder="Digite o nome do contato" type="text" ng-model="searchBy.text" focus-on="isActiveTab(\'search\')" ng-keyup="vm.searchContact(searchBy.text, contactlist.length)" min-length="3"></div><div class="tab-content full" ng-show="isActiveTab(\'config\')"><ul><li><a href="javascript:;"><i class="fa fa-music"></i>Som do bate-papo <switch class="pull-right" ng-model="vm.settings.sound"></switch></a></li><li><a href="javascript:;"><i class="fa fa-flag-o"></i>Notificações no navegador <switch class="pull-right" ng-model="vm.settings.notification"></switch></a></li></ul></div><ul class="chat-contact-list search-results"><li ng-repeat="search in vm.searchResult | orderBy:\'-unreadMessages\':\'-messageDate\'" ng-class="{\'has-unread\': search.unreadMessages > 0, \'has-popup\': contact.popupActive}" ng-click="openPopup(search)"><div class="left"><img class="contact-photo" dummy-image="search.participant[0].photo" dummy-text="search.participant[0].name"><span chat-status="search.participant[0].status"></span></div><div class="right"><h4 class="contact-name" ng-bind-html="search.participant[0].name | trim:true:35 | highlight:searchBy.text"></h4><div class="contact-last-message" ng-bind-html="search.lastMessage | trim:true:35 | colonToSmiley"></div></div></li></ul><div class="error-log" ng-if="vm.errorLog(2)"><i class="fa fa-chain-broken" aria-hidden="true"></i>{{vm.errorLog(2).message}}</div><ul ng-if="!vm.errorLog(2)" class="chat-contact-list" infinite-scroll="vm.getContacts()"><li ng-repeat="contact in contactlist = (vm.contacts | filter: searchBy.text | orderBy: \'-messageDate\')" chat-popover popover-items="contact.participant[0]" popover-placement="left" popover-content="vm.popoverContactTpl" class="animate-list" ng-class="{\'has-unread\': contact.unreadMessages > 0, \'has-popup\': contact.popupActive}" ng-click="openPopup(contact)"><div class="left"><span class="contact-photo"><img dummy-image="contact.participant[0].photo" dummy-text="contact.participant[0].name"></span><span chat-status="contact.participant[0].status"></span></div><div class="right"><h4 class="contact-name" ng-bind-html="contact.participant[0].name | trim:true:35 | highlight:searchBy.text"></h4><div class="contact-last-message" ng-bind-html="contact.lastMessage | trim:true:35 | colonToSmiley"></div></div></li><div ng-show="!contactlist.length && vm.doneContacts || !contactlist.length && vm.searchResults.length" class="error-log"><i class="fa fa-users"></i>Nenhum contato encontrado</div><div chat-loader ng-show="vm.gettingContacts || !vm.doneContacts"></div></ul></div><div class="chat-sidebar-footer"><ul class="chat-navbar"><li class="active"><a href="javascript:;" ng-click="setActiveTab(\'contacts\')"><i class="fa fa-comments"></i></a></li></ul></div></div><div class="chat-popup-container"><div ng-repeat="popup in vm.popups track by popup.roomId" chat-popup="popup" popup-index="$index"></div><div ng-show="vm.popupsGrouped.length" class="popup-group" popup-group="vm.popupsGrouped" popup-group-unreads="vm.groupedUnreads"></div></div>';return{restrict:"EA",template:a,replace:!1,scope:{profile:"=chatProfile"},controller:["$scope","$timeout","ChatAPI",function(a,e,s){function o(t,a){if(!Notification)return void console.log("Desktop notifications not available in your browser.");if("granted"!==Notification.permission)Notification.requestPermission();else{new Notification(t.name,{icon:t.photo,body:a})}}var i=this;i.isConnected=s.isConnected,i.errors=[],i.popoverContactTpl='<div class="chat-contact-info"><div class="popover-media"><span class="contact-photo"><img dummy-image="items.photo" dummy-text="items.name" width="85" height="85"/></span></div><div class="contact-info"><h4 class="contact-name">{{items.name}}</h4><span class="contact-company">{{items.company}}</span></div></div>';var n=new Audio("assets/angular-chat-directive/assets/blob.wav"),c=function(){return"probably"!==n.canPlayType("audio/wav")&&"maybe"!==n.canPlayType("audio/wav")?(console.log("Your browser dont support playing audio files"),!1):void n.play()};i.errorLog=function(t){var a=i.errors.filter(function(a){return parseInt(a.code)===parseInt(t)});return a.length?a[0]:!1},a.$watch("vm.isConnected",function(t){t||i.errors.push({code:"1",message:"Erro ao conectar ao chat. Por favor, tente mais tarde."})}),document.addEventListener("DOMContentLoaded",function(){"granted"!==Notification.permission&&Notification.requestPermission()});var r={};r.check=function(){var t,a=navigator.appName,e=navigator.userAgent,s=e.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*(\.?\d+(\.\d+)*)/i);if(s&&null!=(t=e.match(/version\/([\.\d]+)/i))&&(s[2]=t[1]),s=s?[s[1],s[2]]:[a,navigator.appVersion,"-?"],"MSIE"===s[0]||"Trident"===s[0]||/Edge/.test(navigator.userAgent)){if("Trident"===s[0]&&s[1]<7||"MSIE"===s[0]&&s[1]<9)return void i.errors.push({code:"1",message:"Seu navegador não suporta devidamente as funcionalidades do chat. Por favor, tente utilizar Chrome ou Firefox"});r.support=!1}else r.support=!0;return s}(),i.browser=r,a.$watchCollection("profile.id",function(n){if(void 0!==n){i.profile=a.profile,i.contacts=[],i.popups=[],i.popupsGrouped=[],i.groupedUnreads=0;var r={id:i.profile.id,limit:20,offset:0};s.isConnected&&s.notify().get({id:r.id}).$promise.then(function(a){return t.chatNotifications=a.count},function(a){t.chatNotifications=0,i.errors.push({code:"1",message:"Erro ao conectar ao chat"})}),i.settings={userId:r.id,sound:!1,notification:!1},s.loadSettings().get({userId:r.id}).$promise.then(function(t){if(void 0!==t){var a={sound:t.sound,notification:t.notification};angular.merge(i.settings,a)}}),a.$watch("vm.settings",function(t,a){t!=a&&s.saveSettings().post(t)},!0),i.removePopup=function(t){i.popups=i.popups.filter(function(a){return a.roomId!=t}),a.$broadcast("popupremoved")};var p=!1;i.getContacts=function(){if(i.contactsCount>i.contacts.length&&!p){var t={id:i.profile.id,limit:i.contacts.length+10,offset:i.contacts.length};p=i.gettingContacts=!0,s.contact().get(t).$promise.then(function(t){t.data.forEach(function(t){i.contacts.push(t)}),p=i.gettingContacts=!1},function(t){i.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText}),console.log("Error: ",t.statusText)})}},i.statusList=[{id:1,name:"Online",active:!0},{id:2,name:"Ocupado",active:!1},{id:3,name:"Offline",active:!1},{id:4,name:"Ausente",active:!1}],i.getStatus=function(t){var a=i.statusList.filter(function(a){return a.id==t});return a.length?a[0]:i.statusList[0]},i.currentStatus={},i.currentStatus=i.getStatus(i.profile.status_id),i.changeStatus=function(a){i.currentStatus=i.getStatus(a),i.profile.status_id=a,i.proxy.server.changeStatus(a),t.$broadcast("changestatus")};try{i.proxy=s.methods(),void 0!=i.proxy&&(s.start().done(function(){return i.proxy.server.connect(i.profile.name,i.profile.id,i.profile.status_id,i.profile.systemType)}),i.doneContacts=!1,s.contact().get(r).$promise.then(function(t){i.contactsCount=t.count,i.contacts=t.data,i.doneContacts=!0},function(t){401==t.status&&(t.statusText="Não autorizado"),i.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText+". Recarregue a página ou efetue login novamente."}),i.doneContacts=!1,console.log("Error: ",t.statusText)}),i.searchContact=function(t,a){var e;return i.searchResult=[],0===a?(e={id:i.profile.id,name:t,limit:5,offset:0},s.getuserbyname().get(e).$promise.then(function(t){return i.searchResult=t.data},function(t){return console.log(t.statusText)})):void 0},i.getGroupUnreads=function(){e(function(){return i.popupsGrouped.length?(i.groupedUnreads=0,i.popupsGrouped.forEach(function(t){i.groupedUnreads+=t.unreadMessages}),i.groupedUnreads):void 0},500)},i.proxy.on("receiveMessage",function(s,n,r,p){i.getGroupUnreads(),i.settings.sound&&n!=i.profile.id&&c();var u=i.contacts.filter(function(t){return t.roomId==s});void 0!=u[0]&&n!==i.profile.id&&e(function(){a.$apply(function(){u[0].lastMessage=r.message,u[0].unreadMessages++,t.chatNotifications++}),i.settings.notification&&o(u[0].participant[0],r.message)},0),i.popups.forEach(function(t){return t.roomId===s?(t.messages.splice(0,0,r),!0):void 0})}),i.proxy.on("receiveTyping",function(t,s,o){var n,c=i.contacts.filter(function(t){return t.participant[0].id==o});void 0!=c[0]&&c[0].roomId===s&&o!==a.profile.id&&a.$apply(function(){n=c[0].lastMessage,c[0].lastMessage=t+"...",e(function(){c[0].lastMessage=n},500)}),i.popups.forEach(function(i){return i.roomId===s&&o!==a.profile.id?(i.typing=t,e(function(){i.typing=!1},2e3),!0):void 0})}),i.proxy.on("updateReadMessage",function(t,e,s){i.popups.forEach(function(t){t.messages.forEach(function(t){t.senderId!=a.profile.id&&(void 0!=t.notification[0].readDate&&null!=t.notification[0].readDate||(t.notification[0].readDate=s))})})}),i.proxy.on("userStatus",function(t){return a.$apply(function(){angular.forEach(i.contacts,function(a){return a.participant[0].id===t.id?a.participant[0].status=t.chatStatus:void 0})})}),i.proxy.on("updateContactList",function(t){return t.participant.splice(0,1),a.$apply(function(){i.contacts.splice(0,0,t)})}))}catch(u){i.errors.push({code:"1",message:"Erro ao conectar ao chat"})}}},!0)}],controllerAs:"vm",link:function(t,a,e,s){t.openPopup=function(t){if(s.popupsGrouped.length){var e=s.popupsGrouped.indexOf(t);if(e>-1){var o=s.popups[0];s.popupsGrouped.splice(e,1),s.popups.splice(0,1),s.popupsGrouped.push(o),s.popups.push(t)}}if(s.popups.length>0)var i=($(window).width()-$(a).width())/($(".chat-popup").first().width()*(s.popups.length+1));if(!t.popupActive){if(void 0!=i&&1>i){var o=s.popups[0];s.popups.splice(0,1),s.popupsGrouped.push(o),s.popups.push(t)}else s.popups.push(t);t.popupActive=!0}t.highlight=!0,$("body").addClass("has-chat-popup-active")},t.tabActive=null,t.setActiveTab=function(a){t.tabActive==a?t.tabActive="":t.tabActive=a},s.setActiveTab=t.setActiveTab,t.isActiveTab=function(a){return null!=t.tabActive?a==t.tabActive:void 0},t.toggleChat=function(){a.toggleClass("open closed"),a.hasClass("open")?(a.addClass("open").removeClass("closed"),$("body").addClass("has-chat-sidebar-active")):(a.addClass("closed").removeClass("open"),$("body").removeClass("has-chat-sidebar-active"))},a.hasClass("open")&&$("body").addClass("has-chat-sidebar-active"),e.$observe("chatAttachTo",function(t){if(t){var e=$(t).first();void 0!=e&&$(document).ready(function(){var t=e.height();$(a).css("top",t),$(window).bind("scroll",function(){$(window).scrollTop()>t?$(a).css("top","0px"):$(window).scrollTop()<t&&$(a).css("top",t-$(window).scrollTop())})})}}),e.$observe("chatToggle",function(a){a&&$(a).on("click",function(){t.toggleChat()})})}}}])}).call(this);
(function(){angular.module("ValueChat").directive("chatPopup",["ChatAPI","$rootScope","$timeout","$filter","$sanitize",function(e,t,s,a,o){var n="<div class='popup-box chat-popup slim-scrollbar' ng-class=\"{'popup-on': popup.unreadMessages > 0, 'popup-closed': !popup.toggle}\"><div class='popup-head'><ul class='popup-head-left chat-navbar left'><li><a class='chat-navbar-brand' href='javascript:;' title='{{popup.participant[0].name}}'><span chat-status='popup.participant[0].status'></span> {{popup.participant[0].name | trim:true:21}}<div loading-dots ng-if='popup.typing'></div></a></li></ul><div class='popup-head-right'><ul class='chat-navbar popup-head-buttons right'><li class='chat-popup-toggle' ng-click='togglePopup()'><a href='javascript:;'><i class='fa fa-angle-down'></i></a></li><li class='chat-popup-close'><a href='javascript:;' ng-click='removePopup(popup.roomId)'><i class='fa fa-times'></i></a></li></ul></div></div><div class='tab-content' ng-show=\"isActiveTab('popup-config')\"><ul><li><a href='javascript:;'><i class='fa fa-ban'></i> Bloquear usuário <switch class='pull-right' ng-model='config.block'></switch></a></li></ul></div><div class='popup-messages'><div chat-loader ng-if='!popup.messages.length && !doneMessages || gettingMoreMessages'></div><div class='direct-chat-messages' auto-scroll='popup.messages' auto-scroll-trigger='popup.typing' infinite-scroll='loadMoreMessages()' scroll-inverse='true'><div ng-repeat=\"message in popup.messages | orderBy:'messageDate' track by message.messageDate\" class='direct-chat-msg animate-chat animated' ng-class=\"isMyMessage(message.senderId) ? 'me' : 'user'\"><img alt='message user image' class='direct-chat-img' dummy-image='isMyMessage(message.senderId) ? profile.photo : popup.participant[0].photo' dummy-text='isMyMessage(message.senderId) ? profile.name : popup.participant[0].name'><div class='direct-chat-text' ng-bind-html='message.message | colonToSmiley'></div><div ng-if='isMyMessage(message.senderId)' class='direct-chat-info clearfix'><span class='direct-chat-timestamp'><i class='fa fa-check' ng-show='message.notification[0].readDate'></i><span ng-bind='message.messageDate | amCalendar'></span></span></div></div><div class='direct-chat-msg direct-typing-message user' ng-show='popup.typing'><img alt='message user image' class='direct-chat-img' dummy-image='popup.participant[0].photo' dummy-text='popup.participant[0].name'><div class='direct-chat-text'><div loading-dots></div></div></div></div><div ng-show='errorLog(3)' class='error-log'>{{errorLog(3).message}}</div></div><div class='popup-messages-footer'>"+'<div ng-if="isSupported" class="popup-text-box" emoji-form emoji-message="emojiMessage" ng-click="setReadMessages()" ng-keypress="isTyping($event)" ng-disabled="errorLog(3)"><button id="emojibtn" class="button"><i class="fa fa-smile-o" aria-hidden="true"></i></button><textarea id="messageInput" ng-model="emojiMessage.messagetext" placeholder="Enviar uma mensagem"></textarea><button id="sendbtn" class="button" ng-click="sendMessage()"><i class="fa fa-send" aria-hidden="true"></i></button></div><div ng-if="!isSupported" class="popup-text-box"><textarea class="popup-textarea" cols="40" name="message" placeholder="Enviar uma mensagem" rows="10" ng-model="emojiMessage.messagetext" ng-keypress="isTyping($event)" ng-click="setReadMessages()" ng-disabled="errorLog(3)"></textarea><button id="sendbtn" class="button" ng-click="sendMessage()"><i class="fa fa-send" aria-hidden="true"></i></button></div></div></div>';return{restrict:"EA",require:"^chatSidebar",template:n,scope:{popup:"=chatPopup",index:"=popupIndex"},replace:!0,tranclude:!0,controller:["$scope","$filter","ChatAPI",function(e,t,s){var a={roomId:e.popup.roomId,limit:10,offset:0};e.doneMessages=!1,s.message().get(a).$promise.then(function(t){e.popup.messages=t.data,e.doneMessages=!0},function(t){e.doneMessages=!0,console.log("Error: ",t.statusText)})}],link:function(n,i,r,p){function c(){var e=n.index,t=$(i).width(),s=15*e,a=15,o=t*e+(s+a);0==e&&(o=a),$(i).css({left:o})}n.profile=p.profile,n.isSupported=p.browser.support,n.errors=[],n.errorLog=function(e){var t=n.errors.filter(function(t){return t.code==e});return t[0]},n.emojiMessage={},n.emojiMessage.replyToUser=function(){var e=n.emojiMessage.messagetext.length;e>0&&n.sendMessage()};var l=!0;n.gettingMoreMessages=!1,n.loadMoreMessages=function(){if(l&&!n.gettingMoreMessages){var t={roomId:n.popup.roomId,limit:n.popup.messages.length+20,offset:n.popup.messages.length};n.doneMessages=!1,n.gettingMoreMessages=!0,e.message().get(t).$promise.then(function(e){return n.gettingMoreMessages=!1,0==e.data.length?(l=!1,!1):(angular.forEach(e.data,function(e){n.popup.messages.push(e)}),void(n.doneMessages=!0))},function(e){n.doneMessages=!0,console.log("Error: ",e.statusText)})}},n.removePopup=function(e){n.popup.popupActive=!1,p.removePopup(e),n.$destroy(),p.popups.length<1&&$("body").removeClass("has-chat-popup-active")},n.sendMessage=function(){try{var e=a("stripHTML")(o(n.emojiMessage.messagetext)),t=n.popup.roomId;e.length&&p.proxy.server.sendMessage(t,e).done(function(){n.$apply(function(){n.emojiMessage.messagetext=""})}).fail(function(e){n.errors.push({code:"3",message:"Erro ao enviar mensagem. Atualize a página e tente novamente."}),console.log("Error: ",e)})}catch(s){n.errors.push({code:"3",message:"Erro ao enviar mensagem. Atualize a página e tente novamente."}),console.log("Error: ",s)}},n.setReadMessages=function(){if(n.popup.unreadMessages>0){var a;a={roomId:n.popup.roomId,userId:n.profile.id},e.updateallmessages().put(a).$promise.then(function(){p.proxy.server.userReadMessage(a.roomId,a.userId,n.profile.systemType).done(function(){s(function(){n.popup.unreadMessages=0;var e=0;p.contacts.forEach(function(t){return void 0!=t.unreadMessages?e+=t.unreadMessages:void 0}),t.chatNotifications=e},500)}).fail(function(e){console.log("Error: ",e.statusText)})},function(e){})}};var u;u=void 0,n.isTyping=function(e){var s;if(13!==e.keyCode)s=n.popup.roomId,void 0!==u&&clearTimeout(u),u=setTimeout(function(){p.proxy.server.userIsTyping(s,t.user.status_id)},200);else if(!n.isSupported){var a=n.emojiMessage.messagetext.length;a>0&&n.sendMessage()}},n.$on("$destroy",function(){$(window).width()<768?(i.removeClass("chatSlideInLeft").addClass("chatSlideOutLeft"),s(function(){i.remove()},1e3)):i.remove()}),n.popup.toggle=!0,n.isMyMessage=function(e){return e!=n.popup.participant[0].id},n.$watch("popup.highlight",function(e){e&&(i.addClass("highlight"),setTimeout(function(){i.removeClass("highlight"),n.popup.highlight=!1,n.$apply()},1e3))}),n.togglePopup=function(){n.popup.toggle=!n.popup.toggle},n.$watch("index",function(){c()}),$(window).width()<768?$(i).addClass("chatSlideInLeft"):$(i).addClass("chatSlideInUp"),n.$watch("emojiMessage.messagetext",function(e){angular.isDefined(e)&&(e.length>0?angular.element("#sendbtn").addClass("active"):angular.element("#sendbtn").removeClass("active"))})}}}]).directive("switch",function(){return{restrict:"AE",replace:!0,transclude:!0,require:"?ngModel",template:function(e,t){var s="";return s+="<span",s+=' class="switch'+(t["class"]?" "+t["class"]:"")+'"',s+=t.ngModel?' ng-click="'+t.disabled+" ? "+t.ngModel+" : "+t.ngModel+"=!"+t.ngModel+(t.ngChange?"; "+t.ngChange+'()"':'"'):"",s+=' ng-class="{ checked:'+t.ngModel+", disabled:"+t.disabled+' }"',s+=">",s+="<small></small>",s+='<input type="checkbox"',s+=t.id?' id="'+t.id+'"':"",s+=t.name?' name="'+t.name+'"':"",s+=t.ngModel?' ng-model="'+t.ngModel+'"':"",s+=' style="display:none" />',s+='<span class="switch-text">',s+=t.on?'<span class="on">'+t.on+"</span>":"",s+=t.off?'<span class="off">'+t.off+"</span>":" ",s+="</span>"}}}).directive("dummyImage",function(){return{restrict:"A",scope:{width:"@?",height:"@?",dummyImage:"=?",dummyText:"=",bgcolor:"@?",color:"@?",randomColor:"@?"},link:function(e,t){var s,a,o,n,i,r,p,c;n=function(){var e,t,s;for(s="0123456789ABCDEF".split(""),e="",t=0;6>t;)e+=s[Math.floor(16*Math.random())],t++;return e},s=e.bgcolor||"EEEEEE",a=e.color||"AAAAAA","true"===e.randomColor&&(s=n(),a="FFFFFF"),c=e.width||40,i=e.height||40,p=e.length||2,""!==e.dummyImage&&void 0!==e.dummyImage||(r="assets/angular-chat-directive/assets/loader.gif",t.attr("src",r)),o=function(){if(""!==e.dummyImage&&void 0!==e.dummyImage)return t.attr("src",e.dummyImage);if(null!=e.dummyText){for(var o=e.dummyText.substr(0,p),n="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",l="aaaaaeeeeeiiiiooooouuuunc------",u=0,d=n.length;d>u;u++)o=o.replace(new RegExp(n.charAt(u),"g"),l.charAt(u));r="http://api-valuegaia.gaiacore.com.br/dummy/"+c+"x"+i+"/"+s+"/"+a+"/"+o,t.attr("src",r),t[0].onerror=function(){this.src="assets/angular-chat-directive/assets/user_thumb.png"}}},e.$watchCollection("[dummyImage, dummyText]",function(){return o()})}}}).directive("chatStatus",function(){return{restrict:"EA",scope:{status:"=chatStatus"},link:function(e,t){function s(e){switch(e){case 1:return"online";case 2:return"busy";case 3:return"offline";case 4:return"away"}}e.$watch("status",function(e,a){var o=s(a),n=s(e);$(t).removeClass(o).addClass(n),t.hasClass("chat-status-indicator")||t.addClass("chat-status-indicator")})}}}).directive("autoScroll",function(){return{restrict:"EA",scope:{list:"=autoScroll",typing:"=autoScrollTrigger"},link:function(e,t,s){function a(){var e;e=t.prop("scrollHeight"),$(t).animate({scrollTop:e},100)}s.stopScroll=s.stopScroll||!1,e.$watch("typing",function(e){void 0!=e&&null!=e&&a()}),e.$watchCollection("list",function(){s.stopScroll||a(),s.stopScroll=!1})}}}).directive("chatLoader",function(){return{restrict:"EA",replace:!0,template:'<div class="chat-loader"><svg class="chat-loader-container first" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg><svg class="chat-loader-container second" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg></div>'}}).directive("focusOn",["$timeout",function(e){return function(t,s,a){t.$watch(a.focusOn,function(t){t&&e(function(){s[0].focus()})})}}]).directive("loadingDots",function(){return{restrict:"EA",replace:!0,template:'<div class="loading-dots"><span></span><span></span><span></span></div>'}}).directive("infiniteScroll",["$timeout",function(e){return function(t,s,a){var o=s[0];s.bind("scroll",function(){"true"==a.scrollInverse?0==o.scrollTop&&(t.$apply(a.infiniteScroll),e(function(){o.scrollTop=10},100)):o.scrollTop+o.offsetHeight>=o.scrollHeight&&t.$apply(a.infiniteScroll)})}}]).directive("chatPopover",["$compile",function(e){return{restrict:"EA",transclude:!0,template:"<span ng-transclude></span>",scope:{items:"=?popoverItems",title:"@?",content:"=?popoverContent"},link:function(t,s,a){function o(){var o=a.popoverTrigger||"hover",n=a.popoverPlacement||"bottom",i=$('<div class="chat-popover popover"><div class="arrow"></div><div class="popover-content"></div></div>');void 0!=a.title&&""!=a.title&&$(i).find(".popover-content").before('<h3 class="popover-title"></h3>');var r={template:i,content:e(t.content)(t),placement:n,trigger:o,html:!0,title:t.title};t.items&&t.content&&(r.content=e(t.content)(t)),$(s).popover(r)}a.popoverItems?t.$watch("items",function(e){void 0!=e&&o()}):o()}}}]).directive("popupGroup",["$timeout",function(e){var t='<div class="popup-head" ng-class="{\'popup-on\': unreads > 0}"><i class="fa fa-comments"></i><span class="popup-group-count">{{contacts.length}}</span></div><div class="chat-popover popover fade top in" style="width: 300px; left: -100px;">    <div class="arrow"></div>    <div class="popover-content">    <ul class="chat-contact-list ng-scope">    <li ng-repeat="contact in contacts track by $index" class="animate-list ng-scope" ng-class="{\'has-unread\': contact.unreadMessages > 0}" ng-click="openGroupedPopup(contact)">    <div class="left"><span class="contact-photo"><img dummy-image="contact.participant[0].photo" dummy-text="contact.participant[0].name"></span>    <span chat-status="contact.participant[0].status" class="ng-isolate-scope offline chat-status-indicator"></span>    </div>    <div class="right">    <h4 class="contact-name ng-binding" ng-bind-html="contact.participant[0].name | trim:true:28">Rose Mary da Rocha Oliveira</h4>    <div class="contact-last-message ng-binding" ng-bind-html="contact.lastMessage | trim:true:35 | colonToSmiley">dfgfd</div>    </div><i class="fa fa-times chat-popup-close" ng-click="removeFromGroup(contact)"></i></li></ul></div></div>';return{require:"^chatSidebar",restrict:"EA",template:t,replace:!1,transclude:!0,scope:{contacts:"=popupGroup",unreads:"=?popupGroupUnreads"},link:function(t,s,a,o){t.$watch("popupGroupUnreads",function(e){e&&(console.log("n",e),t.unreads=e)}),s.on({click:function(){s.find(".chat-popover").toggle()}}),s.find(".chat-popover").on({click:function(){return!1}}),t.$watch("contacts",function(e,a){function n(e,t){var s=e.getBoundingClientRect(),a=t.getBoundingClientRect();return s.left<=a.left&&s.right>=a.right}void 0!=e&&($(window).on("resize",function(){if($(window).width()<768&&s.find(".chat-popover").hide(),o.popups.length){var e=n($("body")[0],$(".chat-popup").get($(".chat-popup").length-1));if(!e){var a=o.popups[0];o.popups.splice(0,1),o.popupsGrouped.push(a),t.$apply()}}if(o.popupsGrouped.length){var i;if(i=o.popups.length?($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(o.popups.length+1)):($(window).width()-$(".chat-sidebar").width())/275,i=parseInt(i),void 0!=i&&i>0){var a=o.popupsGrouped[0];o.popups.push(a),o.popupsGrouped.splice(0,1),t.$apply()}}}),t.$on("popupremoved",function(){var e=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(o.popups.length+1));if(void 0!=e&&e>1&&o.popupsGrouped.length){var t=o.popupsGrouped[0];o.popupsGrouped.splice(0,1),o.popups.push(t),o.getGroupUnreads()}}),t.openGroupedPopup=function(e){var s=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(o.popups.length+1));if(void 0!=s&&1>s){var a=o.popups[0];o.popups.splice(0,1),o.popupsGrouped.push(a),o.getGroupUnreads()}e.popupActive=!0,t.contacts=t.contacts.filter(function(t){return t.roomId!=e.roomId}),o.popups.push(e)},t.removeFromGroup=function(e){e.popupActive=!1,t.contacts=t.contacts.filter(function(t){return t.roomId!=e.roomId}),o.getGroupUnreads()})}),t.$watch("contacts.length",function(a,n){if(a!=n){var i=-(65*t.contacts.length);s.find(".chat-popover").css("top",i-10),s.find(".popover-content").css("height",-1*i),o.popupsGrouped.length&&(e(function(){var e=$(".chat-popup").eq(o.popups.length-1).offset().left+275+20;s.animate({left:e},200)},100),o.getGroupUnreads())}})}}}]).filter("trim",function(){return function(e,t,s,a){if(!e)return"";if(s=parseInt(s,10),!s)return e;if(e.length<=s)return e;if(e=e.substr(0,s),t){var o=e.lastIndexOf(" ");-1!=o&&(e=e.substr(0,o))}return e+(a||"…")}}).filter("highlight",["$sce",function(e){return function(t,s){return s&&(t=t.replace(new RegExp("("+s+")","gi"),'<span class="highlighted">$1</span>')),e.trustAsHtml(t)}}]).filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("stripHTML",function(){return function(e){var t=/(<([^>]+)>)/gi;return e.replace(t,"")}})}).call(this);
!function(t,e){"use strict";e.module("ValueChat").factory("ChatAPI",["$resource","$q",function(e,n){function r(t){for(var e=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}var o,i;return o=decodeURIComponent(r("gaiainc_signalr_url")),i=r("gaiainc_webapi_token"),{methods:function(){return t.connection.hub.url=""+o+"/chat",t.connection.valuechat},message:function(){return e(""+o+"/chatapi/message/:roomId",{},{get:{method:"GET",params:{roomId:"@roomId",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+i}}})},contact:function(){return e(""+o+"/chatapi/contact/:id",{},{get:{method:"GET",params:{id:"@id",limit:"@limit",offset:"@offset"},isArray:!1,headers:{Authorization:"Bearer "+i}}})},getuserbyname:function(){return e(""+o+"/chatapi/contact/getuserbyname/:id",{},{get:{method:"GET",params:{id:"@id",name:"@name",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+i}}})},updateallmessages:function(){return e(""+o+"/chatapi/message/updateallmessages/:roomId",{},{put:{method:"PUT",params:{roomId:"@roomId",userId:"@userId"},isArray:!0,headers:{Authorization:"Bearer "+i}}})},notify:function(){return e(""+o+"/chatapi/notify/:id",{},{get:{method:"GET",params:{id:"@id"},isArray:!1,headers:{Authorization:"Bearer "+i}}})},loadSettings:function(){return e(""+o+"/chatapi/settings/getusersetting/:userId",{},{get:{method:"GET",params:{id:"@userId"},headers:{Authorization:"Bearer "+i}}})},saveSettings:function(){return e(""+o+"/chatapi/settings/createsetting",{},{post:{method:"POST",headers:{Authorization:"Bearer "+i}}})},start:function(e){return this.methods().client.onConnected=function(){return console.log("onConnected")},this.methods().client.notifyUser=function(){return console.log("notifyUser")},t.connection.hub.start({transport:["webSockets","longPolling"]})},isConnected:!0,reconnect:function(){return console.log("reconnecting"),e(""+o,{method:"ReAuthenticateWebApi"})}}}])}(jQuery,angular),function(){}.call(this);