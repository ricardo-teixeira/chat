(function(){angular.module("ValueChat").directive("chatPopup",["ChatAPI","$rootScope","$timeout","$filter","$window",function(t,e,a,o,s){var n="<div class='popup-box chat-popup slim-scrollbar' ng-class=\"{'popup-on': popup.unreadMessages > 0, 'popup-closed': !popup.toggle}\"><div class='popup-head'><ul class='popup-head-left chat-navbar left'><li><a class='chat-navbar-brand' href='javascript:;' title='{{popup.participant[0].name}}'><span chat-status='popup.participant[0].status'></span> {{popup.participant[0].name | trim:true:14}}</a></li></ul><div class='popup-head-right'><ul class='chat-navbar popup-head-buttons right'><li class='chat-popup-toggle' ng-click='togglePopup()'><a href='javascript:;'><i class='fa fa-angle-down'></i></a></li><li class='chat-popup-close'><a href='javascript:;' ng-click='removePopup(popup.roomId)'><i class='fa fa-times'></i></a></li></ul></div></div><div class='tab-content' ng-show=\"isActiveTab('popup-config')\"><ul><li><a href='javascript:;'><i class='fa fa-ban'></i> Bloquear usuário <switch class='pull-right' ng-model='config.block'></switch></a></li></ul></div><div class='popup-messages'><div chat-loader ng-if='!popup.messages.length && !doneMessages || gettingMoreMessages'></div><div class='direct-chat-messages' auto-scroll='popup.messages' auto-scroll-trigger='popup.typing' infinite-scroll='loadMoreMessages()' scroll-inverse='true'><div ng-repeat=\"message in popup.messages | orderBy:'messageDate' track by message.messageDate\" class='direct-chat-msg animate-chat animated' ng-class=\"isMyMessage(message.senderId) ? 'me' : 'user'\"><img alt='message user image' class='direct-chat-img' dummy-image='isMyMessage(message.senderId) ? profile.photo : popup.participant[0].photo' dummy-text='isMyMessage(message.senderId) ? profile.name : popup.participant[0].name'><div class='direct-chat-text' ng-bind-html='message.message | colonToSmiley'></div><div ng-if='isMyMessage(message.senderId)' class='direct-chat-info clearfix'><span class='direct-chat-timestamp'><i class='fa fa-check' ng-show='message.notification[0].readDate'></i><span ng-bind='message.messageDate | amCalendar'></span></span></div></div><div class='direct-chat-msg direct-typing-message user' ng-show='popup.typing')><img alt='message user image' class='direct-chat-img' dummy-image='popup.participant[0].photo' dummy-text='popup.participant[0].name'><div class='direct-chat-text'><div class='loading-dots'><span></span><span></span><span></span></div></div></div></div><div ng-show='errorLog(3)' class='error-log'>{{errorLog(3).message}}</div></div><div class='popup-messages-footer'>"+'<div emoji-form emoji-message="emojiMessage" ng-click="setReadMessages()" ng-keypress="isTyping($event)" ng-disabled="errorLog(3)"><button id="emojibtn"><i class="fa fa-smile-o" aria-hidden="true"></i></button><textarea id="messageInput" ng-model="emojiMessage.messagetext" placeholder="Enviar uma mensagem"></textarea></div></div></div>';return{restrict:"EA",require:"^chatSidebar",template:n,scope:{popup:"=chatPopup",index:"=popupIndex"},replace:!0,tranclude:!0,controller:["$scope","$filter","$sanitize","ChatAPI",function(t,e,a,o){var s={roomId:t.popup.roomId,limit:10,offset:0};t.doneMessages=!1,o.message().get(s).$promise.then(function(e){t.popup.messages=e.data,t.doneMessages=!0},function(e){t.doneMessages=!0,console.log("Error: ",e.statusText)})}],link:function(s,n,i,r){function c(){var t=s.index,e=$(n).width(),a=15*t,o=15,i=e*t+(a+o);0==t&&(i=o),$(n).css({left:i})}s.profile=r.profile,s.errors=[],s.errorLog=function(t){var e=s.errors.filter(function(e){return e.code==t});return e[0]},s.emojiMessage={},s.emojiMessage.replyToUser=function(){s.sendMessage()};var p=!0;s.gettingMoreMessages=!1,s.loadMoreMessages=function(){if(p&&!s.gettingMoreMessages){var e={roomId:s.popup.roomId,limit:s.popup.messages.length+20,offset:s.popup.messages.length};s.doneMessages=!1,s.gettingMoreMessages=!0,t.message().get(e).$promise.then(function(t){return s.gettingMoreMessages=!1,0==t.data.length?(p=!1,!1):(angular.forEach(t.data,function(t){s.popup.messages.push(t)}),void(s.doneMessages=!0))},function(t){s.doneMessages=!0,console.log("Error: ",t.statusText)})}},s.removePopup=function(t){s.popup.popupActive=!1,r.removePopup(t),s.$destroy(),r.popups.length<1&&$("body").removeClass("has-chat-popup-active")},s.sendMessage=function(){try{var t=o("stripHTML")(s.emojiMessage.messagetext),e=s.popup.roomId;t.length&&r.proxy.server.sendMessage(e,t).done(function(){s.$apply(function(){s.emojiMessage.messagetext=""})}).fail(function(t){return console.log("Error: ",t)})}catch(a){s.errors.push({code:"3",message:"Erro ao enviar mensagem. Atualize a página e tente novamente."}),console.log(a)}},s.setReadMessages=function(){if(s.popup.unreadMessages>0){var o;o={roomId:s.popup.roomId,userId:s.profile.id},t.updateallmessages().put(o).$promise.then(function(){r.proxy.server.userReadMessage(o.roomId,o.userId,s.profile.systemType).done(function(){a(function(){s.popup.unreadMessages=0;var t=0;r.contacts.forEach(function(e){return void 0!=e.unreadMessages?t+=e.unreadMessages:void 0}),e.chatNotifications=t},500)}).fail(function(t){console.log("Error: ",t.statusText)})},function(t){})}};var u;u=void 0,s.isTyping=function(t){var a;13!==t.keyCode&&(a=s.popup.roomId,void 0!==u&&clearTimeout(u),u=setTimeout(function(){r.proxy.server.userIsTyping(a,e.user.status_id)},200))},s.$on("$destroy",function(){$(window).width()<768?(n.removeClass("chatSlideInLeft").addClass("chatSlideOutLeft"),a(function(){n.remove()},1e3)):n.remove()}),s.popup.toggle=!0,s.isMyMessage=function(t){return t!=s.popup.participant[0].id},s.$watch("popup.highlight",function(t){t&&(n.addClass("highlight"),setTimeout(function(){n.removeClass("highlight"),s.popup.highlight=!1,s.$apply()},1e3))}),s.togglePopup=function(){s.popup.toggle=!s.popup.toggle},s.$watch("index",function(){c()}),$(window).width()<768?$(n).addClass("chatSlideInLeft"):$(n).addClass("chatSlideInUp"),n.on("click",function(){$(".chat-sidebar, body").addClass("narrow-sidebar")})}}}]).directive("popupGroup",function(t){var e='<div class="popup-head" ng-class="{\'popup-on\': unreads > 0}"><i class="fa fa-comments"></i><span class="popup-group-count">{{contacts.length}}</span></div><div class="chat-popover popover fade top in" style="width: 300px; left: -100px;">    <div class="arrow"></div>    <div class="popover-content">    <ul class="chat-contact-list ng-scope">    <li ng-repeat="contact in contacts track by $index" class="animate-list ng-scope" ng-class="{\'has-unread\': contact.unreadMessages > 0}" ng-click="openGroupedPopup(contact)">    <div class="left"><span class="contact-photo"><img dummy-image="contact.participant[0].photo" dummy-text="contact.participant[0].name"></span>    <span chat-status="contact.participant[0].status" class="ng-isolate-scope offline chat-status-indicator"></span>    </div>    <div class="right">    <h4 class="contact-name ng-binding" ng-bind-html="contact.participant[0].name | trim:true:28">Rose Mary da Rocha Oliveira</h4>    <div class="contact-last-message ng-binding" ng-bind-html="contact.lastMessage | trim:true:35 | colonToSmiley">dfgfd</div>    </div><i class="fa fa-times chat-popup-close" ng-click="removeFromGroup(contact)"></i></li></ul></div></div>';return{require:"^chatSidebar",restrict:"EA",template:e,replace:!1,transclude:!0,scope:{contacts:"=popupGroup",unreads:"=?popupGroupUnreads"},link:function(e,a,o,s){e.$watch("popupGroupUnreads",function(t){t&&(console.log("n",t),e.unreads=t)}),a.on({click:function(){a.find(".chat-popover").toggle()}}),a.find(".chat-popover").on({click:function(){return!1}}),e.$watch("contacts",function(t,o){function n(t,e){var a=t.getBoundingClientRect(),o=e.getBoundingClientRect();return a.left<=o.left&&a.right>=o.right}void 0!=t&&($(window).on("resize",function(){if($(window).width()<768&&a.find(".chat-popover").hide(),s.popups.length){var t=n($("body")[0],$(".chat-popup").get($(".chat-popup").length-1));if(!t){var o=s.popups[0];s.popups.splice(0,1),s.popupsGrouped.push(o),e.$apply()}}if(s.popupsGrouped.length){var i;if(i=s.popups.length?($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(s.popups.length+1)):($(window).width()-$(".chat-sidebar").width())/275,i=parseInt(i),void 0!=i&&i>0){var o=s.popupsGrouped[0];s.popups.push(o),s.popupsGrouped.splice(0,1),e.$apply()}}}),e.$on("popupremoved",function(){var t=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(s.popups.length+1));if(void 0!=t&&t>1&&s.popupsGrouped.length){var e=s.popupsGrouped[0];s.popupsGrouped.splice(0,1),s.popups.push(e),s.getGroupUnreads()}}),e.openGroupedPopup=function(t){var a=($(window).width()-$(".chat-sidebar").width())/($(".chat-popup").first().width()*(s.popups.length+1));if(void 0!=a&&1>a){var o=s.popups[0];s.popups.splice(0,1),s.popupsGrouped.push(o),s.getGroupUnreads()}t.popupActive=!0,e.contacts=e.contacts.filter(function(e){return e.roomId!=t.roomId}),s.popups.push(t)},e.removeFromGroup=function(t){t.popupActive=!1,e.contacts=e.contacts.filter(function(e){return e.roomId!=t.roomId}),s.getGroupUnreads()})}),e.$watch("contacts.length",function(o,n){if(o!=n){var i=-(65*e.contacts.length);a.find(".chat-popover").css("top",i-10),a.find(".popover-content").css("height",-1*i),s.popupsGrouped.length&&(t(function(){var t=$(".chat-popup").eq(s.popups.length-1).offset().left+275+20;a.animate({left:t},200)},100),s.getGroupUnreads())}})}}})}).call(this),function(){angular.module("ValueChat",["ngResource","ngSanitize","angularMoment","ngAnimate","emojiApp"]),angular.module("ValueChat").directive("chatSidebar",["$rootScope",function(t){var e="<div class='error-log' ng-if='vm.errorLog(1)'><i class='fa fa-chain-broken' aria-hidden='true'></i>{{vm.errorLog(1).message}}</div><div class='chat-sidebar-container' ng-if='!vm.errorLog(1)'><div class='chat-sidebar-header'><ul class='chat-navbar left'>{{currentStatus | json}}<li ng-class=\"{active: isActiveTab('status')}\"><a class='chat-navbar-brand' ng-click=\"setActiveTab('status')\"><span chat-status='vm.currentStatus.id'></span> {{vm.currentStatus.name}} <i class='fa fa-angle-down'></i></a></li></ul><ul class='chat-navbar right'><li ng-if='!vm.errorLog(2)' ng-class=\"{active: isActiveTab('search')}\"><a href='javascript:;' ng-click=\"setActiveTab('search')\"><i class='fa fa-search'></i></a></li><li ng-class=\"{active: isActiveTab('config')}\"><a href='javascript:;' ng-click=\"setActiveTab('config')\"><i class='fa fa-cog'></i></a></li><li><a class='chat-toggle' href='javascript:;' ng-click='toggleChat()'><i class='fa fa-chevron-right'></i></a></li></ul></div><div class='chat-body slim-scrollbar-dark'><div class='tab-content' ng-show=\"isActiveTab('status')\"><ul><li ng-repeat='status in vm.statusList'><a href='javascript:;' ng-click='vm.changeStatus(status.id)'><span chat-status='status.id'></span>{{status.name}}</a></li></ul></div><div class='tab-content' ng-show=\"isActiveTab('search')\"><input class='search-input' placeholder='Digite o nome do contato' type='text' ng-model='searchBy.text' focus-on=\"isActiveTab('search')\" ng-keyup='vm.searchContact(searchBy.text, contactlist.length)' min-length='3'></div><div class='tab-content full' ng-show=\"isActiveTab('config')\"><ul><li><a href='javascript:;'><i class='fa fa-music'></i>Som do bate-papo <switch class='pull-right' ng-model='vm.settings.sound'></switch></a></li><li><a href='javascript:;'><i class='fa fa-flag-o'></i>Notificações no navegador <switch class='pull-right' ng-model='vm.settings.notifications'></switch></a></li></ul></div><ul class='chat-contact-list search-results'><li ng-repeat='search in vm.searchResult | orderBy:\"-unreadMessages\":\"-messageDate\"' ng-class=\"{'has-unread': search.unreadMessages > 0, 'has-popup': contact.popupActive}\" ng-click='openPopup(search)'><div class='left'><img class='contact-photo' dummy-image='search.participant[0].photo' dummy-text='search.participant[0].name'><span chat-status='search.participant[0].status'></span></div><div class='right'><h4 class='contact-name' ng-bind-html='search.participant[0].name | trim:true:35 | highlight:searchBy.text'></h4><div class='contact-last-message' ng-bind-html='search.lastMessage | trim:true:35 | colonToSmiley'></div></div></li></ul><div class='error-log' ng-if='vm.errorLog(2)'><i class='fa fa-chain-broken' aria-hidden='true'></i>{{vm.errorLog(2).message}}</div><ul ng-if='!vm.errorLog(2)' class='chat-contact-list' infinite-scroll='vm.getContacts()'><li ng-repeat='contact in contactlist = (vm.contacts | filter: searchBy.text | orderBy: \"-messageDate\")' chat-popover popover-items='contact.participant[0]' popover-placement='left' popover-content='vm.popoverContactTpl' class='animate-list' ng-class=\"{'has-unread': contact.unreadMessages > 0, 'has-popup': contact.popupActive}\" ng-click='openPopup(contact)'><div class='left'><span class='contact-photo'><img dummy-image='contact.participant[0].photo' dummy-text='contact.participant[0].name'></span><span chat-status='contact.participant[0].status'></span></div><div class='right'><h4 class='contact-name' ng-bind-html='contact.participant[0].name | trim:true:35 | highlight:searchBy.text'></h4><div class='contact-last-message' ng-bind-html='contact.lastMessage | trim:true:35 | colonToSmiley'></div></div></li><div ng-show='!contactlist.length && vm.doneContacts || !contactlist.length && vm.searchResults.length' class='error-log'><i class='fa fa-users'></i>Nenhum contato encontrado</div><div chat-loader ng-show='vm.gettingContacts || !vm.doneContacts'></div></ul></div><div class='chat-sidebar-footer'><ul class='chat-navbar'><li class='active'><a href='javascript:;' ng-click=\"setActiveTab('contacts')\"><i class='fa fa-comments'></i></a></li></ul></div></div><div class='chat-popup-container'><div ng-repeat='popup in vm.popups track by popup.roomId' chat-popup='popup' popup-index='$index'></div><div ng-show='vm.popupsGrouped.length' class='popup-group' popup-group='vm.popupsGrouped' popup-group-unreads='vm.groupedUnreads'></div></div>";return{restrict:"EA",template:e,replace:!1,scope:{profile:"=chatProfile"},controller:["$scope","$timeout","ChatAPI",function(e,a,o){function s(t,e){if(!Notification)return void console.log("Desktop notifications not available in your browser.");if("granted"!==Notification.permission)Notification.requestPermission();else{new Notification(t.name,{icon:t.photo,body:e})}}var n=this;n.isConnected=o.isConnected,n.errors=[],n.settings={sound:!1,notifications:!1},n.popoverContactTpl="<div class='chat-contact-info'><div class='popover-media'><span class='contact-photo'><img dummy-image='items.photo' dummy-text='items.name' width='85' height='85'/></span></div><div class='contact-info'><h4 class='contact-name'>{{items.name}}</h4><span class='contact-company'>{{items.company}}</span><span class='contact-email' ng-if='items.email'>{{items.email}}</span></div></div>";var i=new Audio("http://www.mscs.mu.edu/~mikes/174/demos/Win98sounds/Utopia%20Critical%20Stop.wav");n.errorLog=function(t){var e=n.errors.filter(function(e){return e.code==t});return e[0]},e.$watch("vm.isConnected",function(t){t||n.errors.push({code:"1",message:"Erro ao conectar ao chat. Por favor, tente mais tarde."})}),document.addEventListener("DOMContentLoaded",function(){"granted"!==Notification.permission&&Notification.requestPermission()}),e.$watchCollection("profile.id",function(r){if(void 0!=r){n.profile=e.profile,n.contacts=[],n.popups=[],n.popupsGrouped=[],n.groupedUnreads=0;var c={id:n.profile.id,limit:20,offset:0};o.isConnected&&o.notify().get({id:c.id}).$promise.then(function(e){return t.chatNotifications=e.count},function(e){t.chatNotifications=0,n.errors.push({code:"1",message:"Erro ao conectar ao chat"})}),n.removePopup=function(t){n.popups=n.popups.filter(function(e){return e.roomId!=t}),e.$broadcast("popupremoved")};var p=!1;n.getContacts=function(){if(n.contactsCount>n.contacts.length&&!p){var t={id:n.profile.id,limit:n.contacts.length+10,offset:n.contacts.length};p=n.gettingContacts=!0,o.contact().get(t).$promise.then(function(t){t.data.forEach(function(t){n.contacts.push(t)}),p=n.gettingContacts=!1},function(t){n.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText}),console.log("Error: ",t.statusText)})}},n.statusList=[{id:1,name:"Online",active:!0},{id:2,name:"Ocupado",active:!1},{id:3,name:"Offline",active:!1},{id:4,name:"Ausente",active:!1}],n.getStatus=function(t){var e=n.statusList.filter(function(e){return e.id==t});return e[0]},n.currentStatus={},n.currentStatus=n.getStatus(n.profile.status_id),n.changeStatus=function(e){n.currentStatus=n.getStatus(e),n.profile.status_id=e,n.proxy.server.changeStatus(e),t.$broadcast("changestatus")};try{n.proxy=o.methods(),void 0!=n.proxy&&(o.start({transport:["webSockets","longPolling"]}).done(function(){return n.proxy.server.connect(n.profile.name,n.profile.id,n.profile.status_id,n.profile.systemType)}),n.doneContacts=!1,o.contact().get(c).$promise.then(function(t){n.contactsCount=t.count,n.contacts=t.data,n.doneContacts=!0},function(t){401==t.status&&(t.statusText="Não autorizado"),n.errors.push({code:"2",message:"Erro ao carregar contatos: "+t.statusText+". Recarregue a página ou efetue login novamente."}),n.doneContacts=!1,console.log("Error: ",t.statusText)}),n.searchContact=function(t,e){var a;return n.searchResult=[],0===e?(a={id:n.profile.id,name:t,limit:5,offset:0},o.getuserbyname().get(a).$promise.then(function(t){return n.searchResult=t.data},function(t){return console.log(t.statusText)})):void 0},n.getGroupUnreads=function(){a(function(){return n.popupsGrouped.length?(n.groupedUnreads=0,n.popupsGrouped.forEach(function(t){n.groupedUnreads+=t.unreadMessages}),n.groupedUnreads):void 0},500)},n.proxy.on("receiveMessage",function(o,r,c,p){n.getGroupUnreads(),n.settings.sound&&r!=n.profile.id&&i.play();var u=n.contacts.filter(function(t){return t.roomId==o});void 0!=u[0]&&r!==n.profile.id&&a(function(){e.$apply(function(){u[0].lastMessage=c.message,u[0].unreadMessages++,t.chatNotifications++}),n.settings.notifications&&s(u[0].participant[0],c.message)},0),n.popups.forEach(function(t){return t.roomId===o?(t.messages.splice(0,0,c),!0):void 0})}),n.proxy.on("receiveTyping",function(t,o,s){var i,r=n.contacts.filter(function(t){return t.participant[0].id==s});void 0!=r[0]&&r[0].roomId===o&&s!==e.profile.id&&e.$apply(function(){i=r[0].lastMessage,r[0].lastMessage=t+"...",a(function(){r[0].lastMessage=i},500)}),n.popups.forEach(function(n){return n.roomId===o&&s!==e.profile.id?(n.typing=t,a(function(){n.typing=!1},2e3),!0):void 0})}),n.proxy.on("updateReadMessage",function(t,a,o){n.popups.forEach(function(t){t.messages.forEach(function(t){t.senderId!=e.profile.id&&(void 0!=t.notification[0].readDate&&null!=t.notification[0].readDate||(t.notification[0].readDate=o))})})}),n.proxy.on("userStatus",function(t){return e.$apply(function(){angular.forEach(n.contacts,function(e){return e.participant[0].id===t.id?e.participant[0].status=t.chatStatus:void 0})})}),n.proxy.on("updateContactList",function(t){return t.participant.splice(0,1),e.$apply(function(){n.contacts.splice(0,0,t)})}))}catch(u){n.errors.push({code:"1",message:"Erro ao conectar ao chat"})}}},!0)}],controllerAs:"vm",link:function(t,e,a,o){t.openPopup=function(t){if(o.popupsGrouped.length){var a=o.popupsGrouped.indexOf(t);if(a>-1){var s=o.popups[0];o.popupsGrouped.splice(a,1),o.popups.splice(0,1),o.popupsGrouped.push(s),o.popups.push(t)}}if(o.popups.length>0)var n=($(window).width()-$(e).width())/($(".chat-popup").first().width()*(o.popups.length+1));if(!t.popupActive){if(void 0!=n&&1>n){var s=o.popups[0];o.popups.splice(0,1),o.popupsGrouped.push(s),o.popups.push(t)}else o.popups.push(t);t.popupActive=!0}t.highlight=!0,$("body").addClass("has-chat-popup-active")},t.tabActive=null,t.setActiveTab=function(e){t.tabActive==e?t.tabActive="":t.tabActive=e},t.isActiveTab=function(e){return null!=t.tabActive?e==t.tabActive:void 0},t.toggleChat=function(){e.toggleClass("open closed"),e.hasClass("open")?(e.addClass("open").removeClass("closed"),$("body").addClass("has-chat-sidebar-active")):(e.addClass("closed").removeClass("open"),$("body").removeClass("has-chat-sidebar-active"))},e.hasClass("open")&&$("body").addClass("has-chat-sidebar-active"),a.$observe("chatAttachTo",function(t){if(t){var a=$(t).first();void 0!=a&&$(document).ready(function(){var t=a.height();$(e).css("top",t),$(window).scroll(function(){$(window).scrollTop()>t?$(e).css("top","0px"):$(window).scrollTop()<t&&$(e).css("top",t)})})}}),a.$observe("chatToggle",function(e){e&&$(e).on("click",function(){t.toggleChat()})}),e.on("mouseenter",".chat-body",function(){e.removeClass("narrow-sidebar"),$("body").removeClass("narrow-sidebar")})}}}])}.call(this),function(){angular.module("ValueChat").directive("switch",function(){return{restrict:"AE",replace:!0,transclude:!0,require:"?ngModel",template:function(t,e){var a="";return a+="<span",a+=' class="switch'+(e["class"]?" "+e["class"]:"")+'"',a+=e.ngModel?' ng-click="'+e.disabled+" ? "+e.ngModel+" : "+e.ngModel+"=!"+e.ngModel+(e.ngChange?"; "+e.ngChange+'()"':'"'):"",a+=' ng-class="{ checked:'+e.ngModel+", disabled:"+e.disabled+' }"',a+=">",a+="<small></small>",a+='<input type="checkbox"',a+=e.id?' id="'+e.id+'"':"",a+=e.name?' name="'+e.name+'"':"",a+=e.ngModel?' ng-model="'+e.ngModel+'"':"",a+=' style="display:none" />',a+='<span class="switch-text">',a+=e.on?'<span class="on">'+e.on+"</span>":"",a+=e.off?'<span class="off">'+e.off+"</span>":" ",a+="</span>"}}}).directive("dummyImage",function(){return{restrict:"A",scope:{width:"@?",height:"@?",dummyImage:"=?",dummyText:"=",bgcolor:"@?",color:"@?",randomColor:"@?"},link:function(t,e){var a,o,s,n,i,r,c,p;n=function(){var t,e,a;for(a="0123456789ABCDEF".split(""),t="",e=0;6>e;)t+=a[Math.floor(16*Math.random())],e++;return t},a=t.bgcolor||"EEEEEE",o=t.color||"AAAAAA","true"===t.randomColor&&(a=n(),o="FFFFFF"),p=t.width||40,i=t.height||40,c=t.length||2,""!==t.dummyImage&&void 0!==t.dummyImage||(r="img/datagrid_load.gif",e.attr("src",r)),s=function(){if(""!==t.dummyImage&&void 0!==t.dummyImage)return e.attr("src",t.dummyImage);if(null!=t.dummyText){for(var s=t.dummyText.substr(0,c),n="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",u="aaaaaeeeeeiiiiooooouuuunc------",l=0,d=n.length;d>l;l++)s=s.replace(new RegExp(n.charAt(l),"g"),u.charAt(l));return r="http://api-valuegaia.gaiacore.com.br/dummy/"+p+"x"+i+"/"+a+"/"+o+"/"+s,e.attr("src",r)}},t.$watchCollection("[dummyImage, dummyText]",function(){return s()})}}}).directive("chatStatus",function(){return{restrict:"EA",scope:{status:"=chatStatus"},link:function(t,e){function a(t){switch(t){case 1:return"online";case 2:return"busy";case 3:return"offline";case 4:return"away"}}t.$watch("status",function(t,o){var s=a(o),n=a(t);$(e).removeClass(s).addClass(n),e.hasClass("chat-status-indicator")||e.addClass("chat-status-indicator")})}}}).directive("autoScroll",function(){return{restrict:"EA",scope:{list:"=autoScroll",typing:"=autoScrollTrigger"},link:function(t,e,a){function o(){var t;t=e.prop("scrollHeight"),$(e).animate({scrollTop:t},100)}a.stopScroll=a.stopScroll||!1,t.$watch("typing",function(t){void 0!=t&&null!=t&&o()}),t.$watchCollection("list",function(){a.stopScroll||o(),a.stopScroll=!1})}}}).directive("chatLoader",function(){return{restrict:"EA",replace:!0,template:'<div class="chat-loader"><svg class="chat-loader-container first" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg><svg class="chat-loader-container second" width="35px" height="35px" viewBox="0 0 52 52"><circle class="chat-loader-path" /></svg></div>'}}).filter("trim",function(){return function(t,e,a,o){if(!t)return"";if(a=parseInt(a,10),!a)return t;if(t.length<=a)return t;if(t=t.substr(0,a),e){var s=t.lastIndexOf(" ");-1!=s&&(t=t.substr(0,s))}return t+(o||"…")}}).directive("chatForm",function(){return{restrict:"A",scope:{action:"&chatFormSubmit"},link:function(t,e){$(e).bind("keydown keypress",function(e){return 13===e.which&&$(this).val().trim().length>0&&!e.shiftKey?(t.$apply(t.action),!1):void 0})}}}).directive("focusOn",function(t){return function(e,a,o){e.$watch(o.focusOn,function(e){e&&t(function(){a[0].focus()})})}}).directive("infiniteScroll",["$timeout",function(t){return function(e,a,o){var s=a[0];a.bind("scroll",function(){"true"==o.scrollInverse?0==s.scrollTop&&(e.$apply(o.infiniteScroll),t(function(){s.scrollTop=10},100)):s.scrollTop+s.offsetHeight>=s.scrollHeight&&e.$apply(o.infiniteScroll)})}}]).directive("chatPopover",function(t){return{restrict:"EA",transclude:!0,template:"<span ng-transclude></span>",scope:{items:"=?popoverItems",title:"@?",content:"=?popoverContent"},link:function(e,a,o){function s(){var s=o.popoverTrigger||"hover",n=o.popoverPlacement||"bottom",i=$('<div class="chat-popover popover"><div class="arrow"></div><div class="popover-content"></div></div>');void 0!=o.title&&""!=o.title&&$(i).find(".popover-content").before('<h3 class="popover-title"></h3>');var r={template:i,content:t(e.content)(e),placement:n,trigger:s,html:!0,title:e.title};e.items&&e.content&&(r.content=t(e.content)(e)),$(a).popover(r)}o.popoverItems?e.$watch("items",function(t){void 0!=t&&s()}):s()}}}).filter("highlight",function(t){return function(e,a){return a&&(e=e.replace(new RegExp("("+a+")","gi"),'<span class="highlighted">$1</span>')),t.trustAsHtml(e)}}).filter("html",function(t){return function(e){return t.trustAsHtml(e)}}).filter("stripHTML",function(){return function(t){var e=/(<([^>]+)>)/gi;return t.replace(e,"")}})}.call(this),function(){angular.module("ValueChat").factory("ChatAPI",["$resource",function(t){function e(t){for(var e=t+"=",a=document.cookie.split(";"),o=0;o<a.length;o++){for(var s=a[o];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(e))return s.substring(e.length,s.length)}return""}var a,o;return a=decodeURIComponent(e("gaiainc_signalr_url")),o=e("gaiainc_webapi_token"),null!=$.connection&&0!==$.connection&&void 0!==a&&void 0!==o?{methods:function(){return $.connection.hub.url=""+a+"/chat",$.connection.valuechat},message:function(){return t(""+a+"/chatapi/message/:roomId",{},{get:{method:"GET",params:{roomId:"@roomId",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+o}}})},contact:function(){return t(""+a+"/chatapi/contact/:id",{},{get:{method:"GET",params:{id:"@id",limit:"@limit",offset:"@offset"},isArray:!1,headers:{Authorization:"Bearer "+o}}})},getuserbyname:function(){return t(""+a+"/chatapi/contact/getuserbyname/:id",{},{get:{method:"GET",params:{id:"@id",name:"@name",limit:"@limit",offset:"@offset"},headers:{Authorization:"Bearer "+o}}})},updateallmessages:function(){return t(""+a+"/chatapi/message/updateallmessages/:roomId",{},{put:{method:"PUT",params:{roomId:"@roomId",userId:"@userId"},isArray:!0,headers:{Authorization:"Bearer "+o}}})},notify:function(){return t(""+a+"/chatapi/notify/:id",{},{get:{method:"GET",params:{id:"@id"},isArray:!1,headers:{Authorization:"Bearer "+o}}})},start:function(t){return this.methods().client.onConnected=function(){return console.log("onConnected")},this.methods().client.notifyUser=function(){},$.connection.hub.start(t)},isConnected:!0,reconnect:function(){return console.log("reconnecting"),t(""+a,{method:"ReAuthenticateWebApi"})}}:(console.log("Erro ao connectar com o chat. Hubs ou SignalR indisponíveis."),{isConnected:!1})}])}.call(this),function(){angular.module("ValueChat").filter("trim",function(){return function(t,e,a,o){if(!t)return"";if(a=parseInt(a,10),!a)return t;if(t.length<=a)return t;if(t=t.substr(0,a),e){var s=t.lastIndexOf(" ");-1!=s&&(t=t.substr(0,s))}return t+(o||"…")}}).filter("highlight",function(t){return function(e,a){return a&&(e=e.replace(new RegExp("("+a+")","gi"),'<span class="highlighted">$1</span>')),t.trustAsHtml(e)}}).filter("html",function(t){return function(e){return t.trustAsHtml(e)}}).filter("stripHTML",function(){return function(t){var e=/(<([^>]+)>)/gi;return t.replace(e,"")}})}.call(this);